import "@typespec/rest";
import "@typespec/http";
import "@azure-tools/typespec-azure-resource-manager";

using TypeSpec.Rest;
using TypeSpec.Http;
using Azure.ResourceManager;
using Azure.ResourceManager.Foundations;

namespace Microsoft.DatabaseFleetManager;

/**
 * The provisioning state of the resource.
 */
union AzureProvisioningState {
  string,
  Azure.ResourceManager.ResourceProvisioningState,

  /** Resource is provisioning. */
  Provisioning: "Provisioning",

  /** Request on the resource has been accepted. */
  Accepted: "Accepted",
}

/**
 * Principal type of the authorized principal.
 */
union PrincipalType {
  string,

  /** Application principal type. */
  Application: "Application",

  /** User principal type. */
  User: "User",
}

/**
 * SQL user type of the authorized principal. Extra: Database user, Sever: Server user, Default: Server admin
 */
union SQLUserType {
  string,

  /** Server admin. */
  Default: "Default",

  /** Database user.. */
  Extra: "Extra",

  /** Server user. */
  Server: "Server",
}

/**
 * Create mode. Available options: Default - Create a database. Copy - Copy the source database (source database name must be specified) PointInTimeRestore - Create a database by restoring source database from a point in time (source database name and restore from time must be specified)
 */
union DatabaseCreateMode {
  string,

  /** Create a database. */
  Default: "Default",

  /** Copy the source database (source database name must be specified). */
  Copy: "Copy",

  /** Create a database by restoring source database from a point in time (source database name and restore from time must be specified). */
  PointInTimeRestore: "PointInTimeRestore",
}

/**
 * Identity type of the main principal.
 */
union IdentityType {
  string,

  /** No identity. */
  None: "None",

  /** User assigned identity. */
  UserAssigned: "UserAssigned",
}

/**
 * A database fleet manager authorized principal properties.
 */
model AuthorizedPrincipalProperties {
  /**
   * Application Id of the authorized principal.
   */
  @visibility("read", "create")
  applicationId?: string;

  /**
   * Object Id of the authorized principal.
   */
  @visibility("read", "create")
  objectId?: string;

  /**
   * Tenant Id of the authorized principal.
   */
  @visibility("read", "create")
  tenantId?: string;

  /**
   * Principal type of the authorized principal.
   */
  @visibility("read", "create")
  principalType?: PrincipalType;

  /**
   * SQL user type of the authorized principal. Extra: Database user, Sever: Server user, Default: Server admin
   */
  @visibility("read", "create")
  sqlUserType?: SQLUserType;

  /**
   * Role assigned to the authorized principal.
   */
  @visibility("read", "create")
  role?: string;

  /**
   * Provisioning state.
   */
  @visibility("read")
  provisioningState?: AzureProvisioningState;
}

/**
 * A database change tier definition.
 */
model DatabaseChangeTierDefinition {
  /**
   * A target tier name.
   */
  @visibility("read", "create")
  targetTierName?: string;
}

/**
 * Fleet database properties.
 */
model FleetDatabaseProperties {
  /**
   * Resource identifier for the underlying database resource.
   */
  @visibility("read")
  originalDatabaseId?: string;

  /**
   * Database state.
   */
  @visibility("read")
  provisioningState?: AzureProvisioningState;

  /**
   * Create mode. Available options: Default - Create a database. Copy - Copy the source database (source database name must be specified) PointInTimeRestore - Create a database by restoring source database from a point in time (source database name and restore from time must be specified)
   */
  @visibility("read", "create")
  createMode?: DatabaseCreateMode;

  /**
   * Name of the tier this database belongs to.
   */
  @visibility("read", "create")
  tierName?: string;

  /**
   * Connection string to connect to the database with.
   */
  @visibility("read")
  connectionString?: string;

  /**
   * If true, database is recoverable.
   */
  @visibility("read")
  recoverable?: boolean;

  /**
   * Restore from time when CreateMode is PointInTimeRestore.
   */
  @visibility("read", "create")
  // FIXME: (utcDateTime) Please double check that this is the correct type for your scenario.
  restoreFromTime?: utcDateTime;

  /**
   * Earliest restore time.
   */
  @visibility("read")
  // FIXME: (utcDateTime) Please double check that this is the correct type for your scenario.
  earliestRestoreTime?: utcDateTime;

  /**
   * Latest restore time.
   */
  @visibility("read")
  // FIXME: (utcDateTime) Please double check that this is the correct type for your scenario.
  latestRestoreTime?: utcDateTime;

  /**
   * Backup retention in days.
   */
  @visibility("read")
  backupRetentionDays?: int32;

  /**
   * Maximum database size in Gb.
   */
  @visibility("read")
  databaseSizeGbMax?: int32;

  /**
   * Source database name used when CreateMode is Copy or PointInTimeRestore.
   */
  @visibility("read", "create")
  sourceDatabaseName?: string;

  /**
   * Additional database properties to be applied as the underlying database resource tags.
   */
  #suppress "@azure-tools/typespec-azure-resource-manager/arm-no-record" "Model properties or operation parameters should not be of type Record. ARM requires Resource provider teams to define types explicitly."
  resourceTags?: Record<string>;

  /**
   * Identity property.
   */
  identity?: Identity;

  /**
   * Transparent Data Encryption properties
   */
  transparentDataEncryption?: TransparentDataEncryption;
}

/**
 * Database Identity.
 */
model Identity {
  /**
   * Identity type of the main principal.
   */
  @visibility("read", "create")
  identityType?: IdentityType;

  /**
   * User identity ids
   */
  @visibility("read", "create")
  @OpenAPI.extension("x-ms-identifiers", [])
  userAssignedIdentities?: DatabaseIdentity[];

  /**
   * Federated Client Id
   */
  @visibility("read", "create")
  federatedClientId?: string;
}

/**
 * Database Identity properties.
 */
model DatabaseIdentity {
  /**
   * Resource Id.
   */
  @visibility("read", "create")
  resourceId?: string;

  /**
   * Azure Active Directory Principal Id.
   */
  @visibility("read", "create")
  principalId?: string;

  /**
   * Azure Active Directory Client Id,
   */
  @visibility("read", "create")
  clientId?: string;
}

/**
 * Transparent Data Encryption properties.
 */
model TransparentDataEncryption {
  /**
   * Customer Managed Key (CMK) Uri.
   */
  @visibility("read", "create")
  keyUri?: string;

  /**
   * Additional Keys
   */
  @visibility("read", "create")
  keys?: string[];

  /**
   * Enable key auto rotation
   */
  @visibility("read", "create")
  enableAutoRotation?: boolean;
}

/**
 * A database rename definition.
 */
model DatabaseRenameDefinition {
  /**
   * New database name.
   */
  @visibility("read", "create")
  newName?: string;
}

/**
 * A Firewall rule properties.
 */
model FirewallRuleProperties {
  /**
   * Start IP address.
   */
  @visibility("read", "create")
  startIpAddress?: string;

  /**
   * End IP address.
   */
  @visibility("read", "create")
  endIpAddress?: string;

  /**
   * Provisioning state.
   */
  @visibility("read")
  provisioningState?: AzureProvisioningState;
}

/**
 * The Database Fleet properties.
 */
model FleetProperties {
  /**
   * Fleet description.
   */
  @visibility("read", "create")
  description?: string;

  /**
   * Provisioning state.
   */
  @visibility("read")
  provisioningState?: AzureProvisioningState;
}

/**
 * A main principal.
 */
model MainPrincipal {
  /**
   * Login name of the main principal.
   */
  @visibility("read", "create")
  login?: string;

  /**
   * Application Id of the main principal.
   */
  @visibility("read", "create")
  applicationId?: string;

  /**
   * Object Id of the main principal.
   */
  @visibility("read", "create")
  objectId?: string;

  /**
   * Tenant Id of the main principal.
   */
  @visibility("read", "create")
  tenantId?: string;

  /**
   * Principal type of the main principal.
   */
  @visibility("read", "create")
  principalType?: PrincipalType;
}

/**
 * A Fleetspace properties.
 */
model FleetspaceProperties {
  /**
   * Fleetspace state.
   */
  @visibility("read")
  provisioningState?: AzureProvisioningState;

  /**
   * Cost cap.
   */
  @visibility("read", "create")
  costCap?: int32;

  /**
   * Main AAD principal that has admin access to all databases in the fleetspace.
   */
  @visibility("read", "create")
  mainPrincipal?: MainPrincipal;
}

/**
 * Server registration definition.
 */
model RegisterServerDefinition {
  /**
   * Destination tier name.
   */
  @visibility("read", "create")
  tierName?: string;

  /**
   * Source subscription id.
   */
  @visibility("read", "create")
  sourceSubscriptionId?: string;

  /**
   * Source resource group name.
   */
  @visibility("read", "create")
  sourceResourceGroupName?: string;

  /**
   * Source SQL Server name.
   */
  @visibility("read", "create")
  sourceServerName?: string;

  /**
   * Destination tier overrides.
   */
  #suppress "@azure-tools/typespec-azure-resource-manager/arm-no-record" "Model properties or operation parameters should not be of type Record. ARM requires Resource provider teams to define types explicitly."
  @visibility("read", "create")
  destinationTierOverrides?: Record<string>;
}

/**
 * A Fleet tier properties.
 */
model FleetTierProperties {
  /**
   * If true, tier is disabled.
   */
  @visibility("read")
  disabled?: boolean;

  /**
   * If true, serverless resources are provisioned in the tier.
   */
  @visibility("read", "create")
  serverless?: boolean;

  /**
   * If true, databases are pooled.
   */
  @visibility("read", "create")
  pooled?: boolean;

  /**
   * Service tier of provisioned resources, for example GeneralPurpose.
   */
  @visibility("read", "create")
  serviceTier?: string;

  /**
   * Family of provisioned resources, for example Gen5.
   */
  @visibility("read", "create")
  family?: string;

  /**
   * Capacity of provisioned resources in the tier, in units matching the specified service tier, for example vCore for GeneralPurpose.
   */
  @visibility("read", "create")
  capacity?: int32;

  /**
   * Maximum number of databases per pool.
   */
  @visibility("read", "create")
  poolNumOfDatabasesMax?: int32;

  /**
   * Number of empty preprovisioned databases for fast database provisioning.
   */
  @visibility("read", "create")
  numOfEmptyPreprovisionedDatabases?: int32;

  /**
   * Minimum allocated capacity per database, in units matching the specified service tier.
   */
  @visibility("read", "create")
  databaseCapacityMin?: float64;

  /**
   * Maximum allocated capacity per database, in units matching the specified service tier.
   */
  @visibility("read", "create")
  databaseCapacityMax?: float64;

  /**
   * Maximum database size in Gb.
   */
  @visibility("read", "create")
  databaseSizeGbMax?: int32;

  /**
   * Provisioning state.
   */
  @visibility("read")
  provisioningState?: AzureProvisioningState;
}

/**
 * A database filter parameters.
 */
model FleetDatabaseFilterParameters {
  /**
   * Filter on database tier name.
   */
  @visibility("read", "create")
  tierName?: string;
}
