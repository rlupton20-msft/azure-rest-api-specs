import "@typespec/http";
import "@typespec/rest";
import "@typespec/versioning";
import "@azure-tools/typespec-azure-core";
import "@azure-tools/typespec-azure-resource-manager";
import "@typespec/openapi";
import "./DeploymentTarget.tsp";
import "./ProvisioningState.tsp";
import "./SolutionInstance.tsp";
import "./SolutionBindingConfiguration.tsp";

using TypeSpec.OpenAPI;
using TypeSpec.Http;
using TypeSpec.Rest;
using TypeSpec.Versioning;
using Azure.Core;
using Azure.ResourceManager;

namespace Private.Edge;

@doc("Configured Solution Version")
model ConfiguredSolutionVersion {
  @doc("Solution Version")
  solutionVersion: string;

  @doc("Latest Configuration Revision")
  latestConfigRevision: string;
}

@doc("Solution Configuration Parameter")
model SolutionConfigurationParameter {
  @doc("Solution Version")
  solutionVersion: string;
}

@doc("Solution Binding Properties")
model SolutionBindingProperties {
  @doc("Solution of target binding")
  @visibility("read")
  solution?: string;

  @doc("Deployment Target of target binding")
  @visibility("read")
  deploymentTarget?: string;

  @doc("Active Deployment Instance of target binding")
  @visibility("read")
  activeSolutionInstance?: string;

  @doc("Scope of target binding")
  @visibility("read")
  scope?: string;

  @doc("Array of configured solution versions")
  @visibility("read")
  @extension("x-ms-identifiers", [])
  configuredSolutionVersions?: ConfiguredSolutionVersion[];

  @doc("Provisioning state of resource")
  @visibility("read")
  provisioningState?: ProvisioningState;
}

@doc("Solution Binding Resource")
model SolutionBinding is TrackedResource<SolutionBindingProperties> {
  ...ResourceNameParameter<
    SolutionBinding,
    NamePattern = "^[a-zA-Z0-9-]{3,60}$"
  >;
}

@armResourceOperations
interface SolutionBindings {
  @doc("Get a Solution Binding Resource")
  get is ArmResourceRead<SolutionBinding>;

  @doc("Create or update a Solution Binding Resource")
  createOrUpdate is ArmResourceCreateOrReplaceAsync<SolutionBinding>;

  @doc("update a Solution Binding Resource")
  update is ArmResourcePatchSync<SolutionBinding, SolutionBindingProperties>;

  @doc("Delete a Solution Binding Resource")
  delete is ArmResourceDeleteSync<SolutionBinding>;

  @doc("List by specified resource group")
  listByResourceGroup is ArmResourceListByParent<SolutionBinding>;

  @doc("List by subscription")
  listBySubscription is ArmListBySubscription<SolutionBinding>;

  @doc("Post request to deploy")
  deploy is ArmResourceActionNoResponseContentAsync<
    SolutionBinding,
    SolutionInstance
  >;

  @doc("Post request to resolve configuration")
  resolveConfiguration is ArmResourceActionAsync<
    SolutionBinding,
    SolutionConfigurationParameter,
    SolutionBindingConfiguration
  >;

  @doc("Post request to publish")
  publish is ArmResourceActionAsync<
    SolutionBinding,
    SolutionInstance,
    SolutionInstance
  >;
}

@doc("Deployment Target Solution Binding Resource")
@parentResource(DeploymentTarget)
@resource("solutionBindings")
model DeploymentTargetSolutionBinding
  is ProxyResource<SolutionBindingProperties> {
  ...ResourceNameParameter<
    DeploymentTargetSolutionBinding,
    NamePattern = "^[a-zA-Z0-9-]{3,60}$"
  >;
}

@armResourceOperations
interface DeploymentTargetSolutionBindings {
  @doc("Get a Solution Binding Resource")
  get is ArmResourceRead<DeploymentTargetSolutionBinding>;

  @doc("Create or update a Solution Binding Resource")
  createOrUpdate is ArmResourceCreateOrReplaceAsync<DeploymentTargetSolutionBinding>;

  @doc("Update a Solution Binding Resource")
  update is ArmResourcePatchSync<
    DeploymentTargetSolutionBinding,
    SolutionBindingProperties
  >;

  @doc("Delete a Solution Binding Resource")
  delete is ArmResourceDeleteSync<DeploymentTargetSolutionBinding>;

  @doc("List by Deployment Target")
  listByDeploymentTarget is ArmResourceListByParent<DeploymentTargetSolutionBinding>;

  @doc("Post request to deploy")
  deploy is ArmResourceActionNoResponseContentAsync<
    DeploymentTargetSolutionBinding,
    SolutionInstance
  >;

  @doc("Post request to resolve configuration")
  resolveConfiguration is ArmResourceActionAsync<
    DeploymentTargetSolutionBinding,
    SolutionConfigurationParameter,
    SolutionBindingConfiguration
  >;

  @doc("Post request to publish")
  publish is ArmResourceActionAsync<
    DeploymentTargetSolutionBinding,
    SolutionInstance,
    SolutionInstance
  >;
}
