import "../common.tsp";

using TypeSpec.Http;
using TypeSpec.Rest;
using TypeSpec.Versioning;
using Azure.Core;
using Azure.ResourceManager;
using OpenAPI;

namespace Private.OracleDatabaseDev;

scalar CloudExadataInfrastructureId
  extends armResourceIdentifier<[
    {
      type: "Private.OracleDatabaseDev/cloudExadataInfrastructures",
    }
  ]>;

@doc("UpdateAction enum")
union UpdateAction {
  @doc("ROLLING_APPLY value")
  RollingApply: "RollingApply",

  @doc("NON_ROLLING_APPLY value")
  NonRollingApply: "NonRollingApply",

  @doc("PRECHECK value")
  PreCheck: "PreCheck",

  @doc("ROLLBACK value")
  RollBack: "RollBack",

  string,
}

@doc("DiskRedundancy enum")
union DiskRedundancy {
  @doc("High value")
  High: "High",

  @doc("Normal value")
  Normal: "Normal",

  string,
}

@doc("CloudVmClusterLifecycleState enum")
union CloudVmClusterLifecycleState {
  @doc("PROVISIONING value")
  Provisioning: "Provisioning",

  @doc("AVAILABLE value")
  Available: "Available",

  @doc("UPDATING value")
  Updating: "Updating",

  @doc("TERMINATING value")
  Terminating: "Terminating",

  @doc("TERMINATED value")
  Terminated: "Terminated",

  @doc("MAINTENANCE_IN_PROGRESS value")
  MaintenanceInProgress: "MaintenanceInProgress",

  @doc("FAILED value")
  Failed: "Failed",

  string,
}

@doc("CloudVmCluster resource definition")
model CloudVmCluster is TrackedResource<CloudVmClusterProperties> {
  @doc("CloudVmCluster name")
  @key("cloudvmclustername")
  @path
  @segment("cloudVmClusters")
  @pattern(".*")
  name: string;
}

@doc("File configuration options")
@added(Versions.v20241201_preview)
model FileSystemConfigurationDetails {
  @doc("Mount path")
  mountPoint?: string;

  @doc("Size of the VM")
  fileSystemSizeGb?: int32;
}

@doc("CloudVmCluster resource model")
model CloudVmClusterProperties {
  @doc("Cloud VM Cluster ocid")
  @visibility("read")
  ocid?: Ocid;

  @doc("The port number configured for the listener on the cloud VM cluster.")
  @visibility("read")
  listenerPort?: int64;

  @doc("The number of nodes in the cloud VM cluster. ")
  @visibility("read")
  nodeCount?: int32;

  @doc("The data disk group size to be allocated in GBs per VM.")
  @visibility("read", "update")
  storageSizeInGbs?: int32;

  @doc("Array of mount path and size.")
  @added(Versions.v20241201_preview)
  @visibility("read", "update")
  @extension("x-ms-identifiers", [])
  fileSystemConfigurationDetails?: FileSystemConfigurationDetails[];

  @doc("The data disk group size to be allocated in TBs.")
  dataStorageSizeInTbs?: float64;

  @doc("The local node storage to be allocated in GBs.")
  dbNodeStorageSizeInGbs?: int32;

  @doc("The memory to be allocated in GBs.")
  memorySizeInGbs?: int32;

  @doc("The date and time that the cloud VM cluster was created.")
  @visibility("read")
  timeCreated?: utcDateTime;

  @doc("Additional information about the current lifecycle state.")
  @visibility("read")
  lifecycleDetails?: string;

  @doc("The time zone of the cloud VM cluster. For details, see [Exadata Infrastructure Time Zones](/Content/Database/References/timezones.htm).")
  @visibility("create", "read")
  @minLength(1)
  @maxLength(255)
  timeZone?: string;

  @doc("The OCID of the zone the cloud VM cluster is associated with.")
  @visibility("create", "read")
  zoneId?: Ocid;

  @doc("The hostname for the cloud VM cluster.")
  @visibility("create", "read")
  @minLength(1)
  @maxLength(23)
  hostname: string;

  @doc("The domain name for the cloud VM cluster.")
  @visibility("create", "read")
  domain?: string;

  @doc("The number of CPU cores enabled on the cloud VM cluster.")
  cpuCoreCount: int32;

  @doc("The number of OCPU cores to enable on the cloud VM cluster. Only 1 decimal place is allowed for the fractional part.")
  ocpuCount?: float32;

  @doc("The cluster name for cloud VM cluster. The cluster name must begin with an alphabetic character, and may contain hyphens (-). Underscores (_) are not permitted. The cluster name can be no longer than 11 characters and is not case sensitive. ")
  @visibility("create", "read")
  @minLength(1)
  @maxLength(11)
  clusterName?: string;

  @doc("The percentage assigned to DATA storage (user data and database files). The remaining percentage is assigned to RECO storage (database redo logs, archive logs, and recovery manager backups). Accepted values are 35, 40, 60 and 80. The default is 80 percent assigned to DATA storage. See [Storage Configuration](/Content/Database/Concepts/exaoverview.htm#Exadata) in the Exadata documentation for details on the impact of the configuration settings on storage. ")
  @visibility("create", "read")
  dataStoragePercentage?: int32;

  @doc("If true, database backup on local Exadata storage is configured for the cloud VM cluster. If false, database backup on local Exadata storage is not available in the cloud VM cluster. ")
  @visibility("create", "read")
  isLocalBackupEnabled?: boolean = false;

  @doc("Cloud Exadata Infrastructure ID")
  @visibility("create", "read")
  cloudExadataInfrastructureId: CloudExadataInfrastructureId;

  @doc("If true, sparse disk group is configured for the cloud VM cluster. If false, sparse disk group is not created. ")
  @visibility("create", "read")
  isSparseDiskgroupEnabled?: boolean = false;

  @doc("Operating system version of the image.")
  @visibility("read")
  @minLength(1)
  @maxLength(255)
  systemVersion?: string;

  @doc("The public key portion of one or more key pairs used for SSH access to the cloud VM cluster.")
  sshPublicKeys: string[];

  @doc("The Oracle license model that applies to the cloud VM cluster. The default is LICENSE_INCLUDED. ")
  licenseModel?: LicenseModel;

  @doc("The type of redundancy configured for the cloud Vm cluster. NORMAL is 2-way redundancy. HIGH is 3-way redundancy. ")
  @visibility("read")
  diskRedundancy?: DiskRedundancy;

  @doc("The Single Client Access Name (SCAN) IP addresses associated with the cloud VM cluster. SCAN IP addresses are typically used for load balancing and are not assigned to any interface. Oracle Clusterware directs the requests to the appropriate nodes in the cluster. **Note:** For a single-node DB system, this list is empty.")
  @visibility("read")
  scanIpIds?: string[];

  @doc("The virtual IP (VIP) addresses associated with the cloud VM cluster. The Cluster Ready Services (CRS) creates and maintains one VIP address for each node in the Exadata Cloud Service instance to enable failover. If one node fails, the VIP is reassigned to another active node in the cluster. **Note:** For a single-node DB system, this list is empty.")
  @visibility("read")
  vipIds?: string[];

  @doc("The FQDN of the DNS record for the SCAN IP addresses that are associated with the cloud VM cluster. ")
  @visibility("read")
  @minLength(1)
  @maxLength(72)
  scanDnsName?: string;

  @doc("The TCP Single Client Access Name (SCAN) port. The default port is 1521.")
  @visibility("create", "read")
  scanListenerPortTcp?: int32;

  @doc("The TCPS Single Client Access Name (SCAN) port. The default port is 2484.")
  @visibility("create", "read")
  scanListenerPortTcpSsl?: int32;

  @doc("The OCID of the DNS record for the SCAN IP addresses that are associated with the cloud VM cluster.")
  @visibility("read")
  scanDnsRecordId?: Ocid;

  @doc("The model name of the Exadata hardware running the cloud VM cluster.")
  @visibility("read")
  @minLength(1)
  @maxLength(255)
  shape?: string;

  @doc("CloudVmCluster provisioning state")
  @visibility("read")
  provisioningState?: AzureResourceProvisioningState;

  @doc("CloudVmCluster lifecycle state")
  @visibility("read")
  lifecycleState?: CloudVmClusterLifecycleState;

  @doc("VNET for network connectivity")
  @visibility("create", "read")
  vnetId: VnetId;

  @doc("Oracle Grid Infrastructure (GI) software version")
  @visibility("create", "read")
  giVersion: string;

  @doc("HTTPS link to OCI resources exposed to Azure Customer via Azure Interface.")
  @visibility("read")
  ociUrl?: string;

  @doc("HTTPS link to OCI Network Security Group exposed to Azure Customer via the Azure Interface.")
  @visibility("read")
  nsgUrl?: string;

  @doc("Client subnet")
  @visibility("create", "read")
  subnetId: SubnetId;

  @doc("Client OCI backup subnet CIDR, default is 192.168.252.0/22")
  @visibility("create", "read")
  @minLength(1)
  @maxLength(32)
  backupSubnetCidr?: string;

  @doc("CIDR blocks for additional NSG ingress rules. The VNET CIDRs used to provision the VM Cluster will be added by default.")
  @visibility("create", "read")
  @extension("x-ms-identifiers", [])
  nsgCidrs?: NsgCidr[];

  @doc("Indicates user preferences for the various diagnostic collection options for the VM cluster/Cloud VM cluster/VMBM DBCS.")
  dataCollectionOptions?: DataCollectionOptions;

  @doc("Display Name")
  @minLength(1)
  @maxLength(255)
  displayName: string;

  @doc("The list of compute servers to be added to the cloud VM cluster.")
  @visibility("update")
  computeNodes?: Ocid[];

  @doc("iormConfigCache details for cloud VM cluster.")
  @visibility("read")
  iormConfigCache?: ExadataIormConfig;

  @doc("The OCID of the last maintenance update history entry.")
  @visibility("read")
  lastUpdateHistoryEntryId?: Ocid;

  @doc("The list of DB servers.")
  @visibility("create", "read")
  dbServers?: Ocid[];

  @doc("Cluster compartmentId")
  @visibility("read")
  compartmentId?: Ocid;

  @doc("Cluster subnet ocid")
  @visibility("read")
  subnetOcid?: Ocid;
}

@doc("Add/Remove (Virtual Machine) DbNode model")
model AddRemoveDbNode {
  @doc("Db servers ocids")
  dbServers: Array<Ocid>;
}
