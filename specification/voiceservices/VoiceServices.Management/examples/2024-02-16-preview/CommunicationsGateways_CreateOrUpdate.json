{
  "operationId": "CommunicationsGateways_CreateOrUpdate",
  "title": "CreateCommunicationsGatewayResource",
  "parameters": {
    "subscriptionId": "00000000-0000-0000-0000-000000000000",
    "resourceGroupName": "testrg",
    "api-version": "2024-02-16-preview",
    "name": "myname",
    "communicationsGatewayName": "myname",
    "resource": {
      "location": "useast",
      "sku": {
        "name": "standard"
      },
      "properties": {
        "operatorPeerGroupConfigScheme": "UseOperatorPeerGroupConfig",
        "connectivity": "PublicAddress",
        "serviceLocations": [
          {
            "name": "eastUs",
            "primaryRegionProperties": {
              "operatorAddresses": [
                "10.1.1.1"
              ]
            }
          },
          {
            "name": "westtUs",
            "primaryRegionProperties": {
              "operatorAddresses": [
                "10.1.1.2"
              ]
            }
          }
        ],
        "peerGroups": [
          {
            "peerGroupName": "TPMPrd",
            "peers": [
              {
                "peerName": "TPMPrd1",
                "peerType": "IP",
                "ipsAndPorts": [
                  {
                    "ipAddress": "23.3.56.7",
                    "port": 5060
                  }
                ],
                "allowedSignalingSourceAddressPrefixes": [
                  "23.3.56.0/29",
                  "23.3.57.0/29"
                ],
                "allowedMediaSourceAddressPrefixes": [
                  "23.3.56.0/29",
                  "23.3.57.0/29"
                ]
              },
              {
                "peerName": "TPMPrd2",
                "peerType": "IP",
                "ipsAndPorts": [
                  {
                    "ipAddress": "23.3.57.7",
                    "port": 5060
                  }
                ],
                "allowedSignalingSourceAddressPrefixes": [
                  "23.3.58.0/29",
                  "23.3.59.0/29"
                ],
                "allowedMediaSourceAddressPrefixes": [
                  "23.3.58.0/29",
                  "23.3.59.0/29"
                ]
              }
            ],
            "signalingProtocol": "TLS",
            "mediaProtocol": "SRTP",
            "codecs": [
              "PCMA",
              "PCMU",
              "G722"
            ]
          },
          {
            "peerGroupName": "OCProd",
            "peers": [
              {
                "peerName": "OCPrd1",
                "peerType": "ARecord",
                "aRecordsAndPorts": [
                  {
                    "aRecord": "xx.yy.com",
                    "port": 5060
                  }
                ],
                "allowedSignalingSourceAddressPrefixes": [
                  "23.3.56.0/29",
                  "23.3.57.0/29"
                ],
                "allowedMediaSourceAddressPrefixes": [
                  "23.3.56.0/29",
                  "23.3.57.0/29"
                ]
              },
              {
                "peerName": "OCPrd2",
                "peerType": "SRV",
                "srvRecord": "_sip._tls.someimsnetwork.fqdn.com",
                "allowedSignalingSourceAddressPrefixes": [
                  "23.3.56.0/29",
                  "23.3.57.0/29"
                ],
                "allowedMediaSourceAddressPrefixes": [
                  "23.3.56.0/29",
                  "23.3.57.0/29"
                ]
              }
            ],
            "signalingProtocol": "TLS",
            "mediaProtocol": "SRTP",
            "codecs": [
              "PCMA",
              "PCMU",
              "G722"
            ]
          }
        ],
        "callPolicy": {
          "defaultMappings": {
            "peerGroupToService": [
              {
                "peerGroup": "TPMPrd",
                "defaultService": "TeamsPhoneMobile"
              },
              {
                "peerGroup": "OCProd",
                "defaultService": "OperatorConnect"
              }
            ],
            "serviceToPeerGroup": [
              {
                "service": "TeamsPhoneMobile",
                "defaultPeerGroup": "TPMPrd"
              },
              {
                "service": "OperatorConnect",
                "defaultPeerGroup": "OCProd"
              }
            ]
          },
          "peerGroupRoutings": [
            {
              "peerGroupName": "TPMPrd",
              "routings": [
                {
                  "peerName": "TPMPrd1",
                  "serviceLocation": "westUS",
                  "priority": 0
                },
                {
                  "peerName": "TPMPrd1",
                  "serviceLocation": "eastUS",
                  "priority": 1
                },
                {
                  "peerName": "TPMPrd2",
                  "serviceLocation": "westUS",
                  "priority": 1
                },
                {
                  "peerName": "TPMPrd2",
                  "serviceLocation": "eastUS",
                  "priority": 0
                }
              ]
            }
          ]
        },
        "codecs": [
          "PCMA",
          "PCMU",
          "G722",
          "G722_2",
          "SILK_8",
          "SILK_16"
        ],
        "customSipHeaders": {
          "headers": [
            {
              "name": "custom_header"
            }
          ]
        },
        "e911Type": "Standard",
        "platforms": [
          "OperatorConnect",
          "TeamsPhoneMobile"
        ],
        "autoGeneratedDomainNameLabelScope": "TenantReuse",
        "onPremMcpEnabled": false,
        "integratedMcpEnabled": true,
        "preferredProtocolForMcp": "TLS/TCP",
        "emergencyDialStrings": [
          "112",
          "911",
          "933",
          "999"
        ],
        "teamsVoicemailPilotNumber": "11231231234",
        "apiBridge": {
          "configureApiBridge": "enabled",
          "allowedAddressPrefixes": [
            "198.51.100.192/26"
          ]
        }
      }
    }
  },
  "responses": {
    "200": {
      "body": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testrg/providers/Microsoft.VoiceServices/communicationsGateways/myname",
        "name": "myname",
        "type": "Microsoft.VoiceServices/communicationsGateways",
        "location": "useast",
        "sku": {
          "name": "standard"
        },
        "properties": {
          "operatorPeerGroupConfigScheme": "UseOperatorPeerGroupConfig",
          "connectivity": "PublicAddress",
          "serviceLocations": [
            {
              "name": "eastUs",
              "primaryRegionProperties": {
                "operatorAddresses": [
                  "10.1.1.1"
                ]
              },
              "acgAddressRanges": {
                "signalingForBackendServices": [
                  "12.34.12.1/30"
                ],
                "signalingForOperator": [
                  "12.34.12.1/30"
                ],
                "mediaForBackendServices": [
                  "12.34.12.1/30"
                ],
                "mediaForOperator": [
                  "12.34.12.1/30"
                ]
              },
              "acgContactInfo": {
                "peerGroups": [
                  {
                    "peerGroupName": "TPMPrd",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "port": 1234
                  },
                  {
                    "peerGroupName": "TPMPrd2",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.3",
                      "192.0.2.4"
                    ],
                    "port": 5678
                  }
                ],
                "backendServices": [
                  {
                    "serviceName": "Zoom",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "srvRecord": "",
                    "port": 1234
                  },
                  {
                    "serviceName": "TPM",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "port": 1234
                  }
                ]
              }
            },
            {
              "name": "westUs",
              "primaryRegionProperties": {
                "operatorAddresses": [
                  "10.1.1.2"
                ]
              },
              "acgAddressRanges": {
                "signalingForBackendServices": [
                  "12.34.12.1/30"
                ],
                "signalingForOperator": [
                  "12.34.12.1/30"
                ],
                "mediaForBackendServices": [
                  "12.34.12.1/30"
                ],
                "mediaForOperator": [
                  "12.34.12.1/30"
                ]
              },
              "acgContactInfo": {
                "peerGroups": [
                  {
                    "peerGroupName": "TPMPrd",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "port": 1234
                  },
                  {
                    "peerGroupName": "OCProd",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.3",
                      "192.0.2.4"
                    ],
                    "port": 5678
                  }
                ],
                "backendServices": [
                  {
                    "serviceName": "OC",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "srvRecord": "",
                    "port": 1234
                  },
                  {
                    "serviceName": "TPM",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "port": 1234
                  }
                ]
              }
            }
          ],
          "peerGroups": [
            {
              "peerGroupName": "TPMPrd",
              "peers": [
                {
                  "peerName": "TPMPrd1",
                  "peerType": "IP",
                  "ipsAndPorts": [
                    {
                      "ipAddress": "23.3.56.7",
                      "port": 5060
                    }
                  ],
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                },
                {
                  "peerName": "TPMPrd2",
                  "peerType": "IP",
                  "ipsAndPorts": [
                    {
                      "ipAddress": "23.3.57.7",
                      "port": 5060
                    }
                  ],
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                }
              ],
              "signalingProtocol": "TLS",
              "mediaProtocol": "SRTP",
              "codecs": [
                "PCMA",
                "PCMU",
                "G722"
              ]
            },
            {
              "peerGroupName": "OCProd",
              "peers": [
                {
                  "peerName": "OCPrd1",
                  "peerType": "ARecord",
                  "aRecordsAndPorts": [
                    {
                      "aRecord": "xx.yy.com",
                      "port": 5060
                    }
                  ],
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                },
                {
                  "peerName": "OCPrd2",
                  "peerType": "SRV",
                  "srvRecord": "_sip._tls.someimsnetwork.fqdn.com",
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                }
              ],
              "signalingProtocol": "TLS",
              "mediaProtocol": "SRTP",
              "codecs": [
                "PCMA",
                "PCMU",
                "G722"
              ]
            }
          ],
          "callPolicy": {
            "defaultMappings": {
              "peerGroupToService": [
                {
                  "peerGroup": "TPMPrd",
                  "defaultService": "TeamsPhoneMobile"
                },
                {
                  "peerGroup": "OCProd",
                  "defaultService": "TeamsPhoneMobile"
                }
              ],
              "serviceToPeerGroup": [
                {
                  "service": "TeamsPhoneMobile",
                  "defaultPeerGroup": "TPMPrd"
                },
                {
                  "service": "OperatorConnect",
                  "defaultPeerGroup": "OCProd"
                }
              ]
            },
            "peerGroupRoutings": [
              {
                "peerGroupName": "TPMPrd",
                "routings": [
                  {
                    "peerName": "TPMPrd1",
                    "serviceLocation": "westUS",
                    "priority": 0
                  },
                  {
                    "peerName": "TPMPrd1",
                    "serviceLocation": "eastUS",
                    "priority": 1
                  },
                  {
                    "peerName": "TPMPrd2",
                    "serviceLocation": "westUS",
                    "priority": 1
                  },
                  {
                    "peerName": "TPMPrd2",
                    "serviceLocation": "eastUS",
                    "priority": 0
                  }
                ]
              }
            ]
          },
          "codecs": [
            "PCMA",
            "PCMU",
            "G722",
            "G722_2",
            "SILK_8",
            "SILK_16"
          ],
          "customSipHeaders": {
            "headers": [
              {
                "name": "custom_header"
              }
            ]
          },
          "e911Type": "Standard",
          "platforms": [
            "OperatorConnect",
            "TeamsPhoneMobile"
          ],
          "autoGeneratedDomainNameLabelScope": "TenantReuse",
          "autoGeneratedDomainNameLabel": "h6emgfescubyguek",
          "onPremMcpEnabled": false,
          "integratedMcpEnabled": true,
          "preferredProtocolForMcp": "TLS/TCP",
          "emergencyDialStrings": [
            "112",
            "911",
            "933",
            "999"
          ],
          "teamsVoicemailPilotNumber": "11231231234"
        }
      }
    },
    "201": {
      "body": {
        "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testrg/providers/Microsoft.VoiceServices/communicationsGateways/myname",
        "name": "myname",
        "type": "Microsoft.VoiceServices/communicationsGateways",
        "location": "useast",
        "sku": {
          "name": "standard"
        },
        "properties": {
          "status": "ChangePending",
          "operatorPeerGroupConfigScheme": "UseOperatorPeerGroupConfig",
          "connectivity": "PublicAddress",
          "serviceLocations": [
            {
              "name": "eastUs",
              "primaryRegionProperties": {
                "operatorAddresses": [
                  "10.1.1.1"
                ]
              },
              "acgAddressRanges": {
                "signalingForBackendServices": [
                  "12.34.12.1/30"
                ],
                "signalingForOperator": [
                  "12.34.12.1/30"
                ],
                "mediaForBackendServices": [
                  "12.34.12.1/30"
                ],
                "mediaForOperator": [
                  "12.34.12.1/30"
                ]
              },
              "acgContactInfo": {
                "peerGroups": [
                  {
                    "peerGroupName": "TPMPrd",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "port": 1234
                  },
                  {
                    "peerGroupName": "OCProd",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.3",
                      "192.0.2.4"
                    ],
                    "port": 5678
                  }
                ],
                "backendServices": [
                  {
                    "serviceName": "Zoom",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "srvRecord": "",
                    "port": 1234
                  },
                  {
                    "serviceName": "TPM",
                    "srvRecord": "xx.yy.com",
                    "ipAddresses": [
                      "192.0.2.1",
                      "192.0.2.2"
                    ],
                    "port": 1234
                  }
                ]
              }
            }
          ],
          "peerGroups": [
            {
              "peerGroupName": "TPMPrd",
              "peers": [
                {
                  "peerName": "TPMPrd1",
                  "peerType": "IP",
                  "ipsAndPorts": [
                    {
                      "ipAddress": "23.3.56.7",
                      "port": 5060
                    }
                  ],
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                },
                {
                  "peerName": "TPMPrd2",
                  "peerType": "IP",
                  "ipsAndPorts": [
                    {
                      "ipAddress": "23.3.57.7",
                      "port": 5060
                    }
                  ],
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                }
              ],
              "signalingProtocol": "TLS",
              "mediaProtocol": "SRTP",
              "codecs": [
                "PCMA",
                "PCMU",
                "G722"
              ]
            },
            {
              "peerGroupName": "OCProd",
              "peers": [
                {
                  "peerName": "OCPrd1",
                  "peerType": "ARecord",
                  "aRecordsAndPorts": [
                    {
                      "aRecord": "xx.yy.com",
                      "port": 5060
                    }
                  ],
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                },
                {
                  "peerName": "OCPrd2",
                  "peerType": "SRV",
                  "srvRecord": "_sip._tls.someimsnetwork.fqdn.com",
                  "allowedSignalingSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ],
                  "allowedMediaSourceAddressPrefixes": [
                    "23.3.56.0/29",
                    "23.3.57.0/29"
                  ]
                }
              ],
              "signalingProtocol": "TLS",
              "mediaProtocol": "SRTP",
              "codecs": [
                "PCMA",
                "PCMU",
                "G722"
              ]
            }
          ],
          "callPolicy": {
            "defaultMappings": {
              "peerGroupToService": [
                {
                  "peerGroup": "TPMPrd",
                  "defaultService": "TeamsPhoneMobile"
                },
                {
                  "peerGroup": "OCProd",
                  "defaultService": "OperatorConnect"
                }
              ],
              "serviceToPeerGroup": [
                {
                  "service": "TeamsPhoneMobile",
                  "defaultPeerGroup": "TPMPrd"
                },
                {
                  "service": "OperatorConnect",
                  "defaultPeerGroup": "OCProd"
                }
              ]
            },
            "peerGroupRoutings": [
              {
                "peerGroupName": "TPMPrd",
                "routings": [
                  {
                    "peerName": "TPMPrd1",
                    "serviceLocation": "westUS",
                    "priority": 0
                  },
                  {
                    "peerName": "TPMPrd1",
                    "serviceLocation": "eastUS",
                    "priority": 1
                  },
                  {
                    "peerName": "TPMPrd2",
                    "serviceLocation": "westUS",
                    "priority": 1
                  },
                  {
                    "peerName": "TPMPrd2",
                    "serviceLocation": "eastUS",
                    "priority": 0
                  }
                ]
              }
            ]
          },
          "codecs": [
            "PCMA",
            "PCMU",
            "G722",
            "G722_2",
            "SILK_8",
            "SILK_16"
          ],
          "customSipHeaders": {
            "headers": [
              {
                "name": "custom_header"
              }
            ]
          },
          "e911Type": "Standard",
          "platforms": [
            "OperatorConnect",
            "TeamsPhoneMobile"
          ],
          "autoGeneratedDomainNameLabelScope": "TenantReuse",
          "autoGeneratedDomainNameLabel": "h6emgfescubyguek",
          "onPremMcpEnabled": false,
          "integratedMcpEnabled": true,
          "preferredProtocolForMcp": "TLS/TCP",
          "emergencyDialStrings": [
            "112",
            "911",
            "933",
            "999"
          ],
          "teamsVoicemailPilotNumber": "11231231234"
        }
      }
    }
  }
}
